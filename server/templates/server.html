{% extends "layout.html" %}
{% block title %}Server{% endblock %}
{% block body %}
<div class="main">
  <div class="main-inner">
    <div class="container">
      <div class="row">
        <div class="span12">
            <div class="widget">
            <div class="widget-header"> <i class="icon-signal"></i>
              <h3> Server Control </h3>
            </div>
            <!-- /widget-header -->
          <div class="widget-content">
                <form class="form-horizontal" method="post" action="{{ url_for('server_start') }}">
                    <div class="control-group">
                        <label class="control-label" for="case">Case:</label>
                        <div class="controls">
                            <select class="span3" name="case">{% if cases %}{% for case in cases %}<option value="{{ case }}">{{ case }}</option>{% endfor %}{% endif %}</select>
                        </div>
                    </div>
                    <fieldset>
                    <div class="control-group">
                        <label class="control-label" for="interface">Interface:</label>
                        <div class="controls">
                            <select class="span3" name="interface">{% if interfaces %}{% for interface in interfaces %}<option value="{{ interface[0] }}" {% if interface[0] == defaultinterface %}selected{% endif %}>{{ interface[1] }}</option>{% endfor %}{% endif %}</select>
                        </div>
                    </div><br/>
                    <div class="form-actions">
                        <input class="btn btn-primary" type="submit" value="Start Server"/>
                    </div>
                    </fieldset>
                </form>
            </div>
          <!-- /widget -->
        </div>
        <!-- /span6 -->
      </div>
      <!-- /row -->
    </div>
    <!-- /container -->
    <div class="container">
            <div class="widget widget-table action-table">
                <div class="widget-header"><i class="icon-th-list"></i>

                    <h3>Active Listeners</h3>
                </div>
                <!-- /widget-header -->
                <div class="widget-content">
                    <table class="table table-striped table-bordered">
                        <thead>
                        <tr>
                            <th> Mode</th>
                            <th> Case</th>
                            <th> Target</th>
                            <th> Status</th>
                            <th class="td-actions"> Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for task in tasks %}
                        <tr>
                            <td> {% print task[0].split('|')[0] %} ({% print task[1] %})</td>
                            <td> {% print task[0].split('|')[1] %}</td>
                            <td> {% print task[0].split('|')[2] %}</td>
                            <td style="text-align: center;">
                                Running
                                <!--<div class="progress progress-striped active" style="margin-bottom: 0px;">
                                    <div class="bar" style="width: 100%;"></div>
                                </div>-->
                            </td>
                            <form action="/stop/{% print task[1] %}">
                            <td class="td-actions">
                                <input type="submit" onclick=''
                                                                                class="btn btn-danger" value="Stop"/>

                            </td>
                            </form>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" style="text-align: center;"> No listeners running</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>

                    <script>
                $(document).ready(function(){
                    //var socket = io.connect('http://127.0.0.1:8080/bucket');
                    //socket.send('test')
                    //var socket = io.connect('http://127.0.0.1:8080/status');
                    //socket.on('taskupdate', function(msg) {
                    //    $('#log').append('<p>Received: ' + msg.data + '</p>');
                    //});
                });

                    </script>
                </div>
                <!-- /widget-content -->
            </div>
            <!-- /widget -->
        </div>
        <!-- /span12 -->
  </div>
  <!-- /main-inner -->
</div>
<!-- /main -->
{% endblock %}